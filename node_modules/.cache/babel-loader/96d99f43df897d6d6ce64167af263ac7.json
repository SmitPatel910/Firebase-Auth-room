{"ast":null,"code":"'use strict';\n\nvar crc;\n\ntry {\n  crc = require('fast-crc32c');\n} catch (e) {\n  crc = require('./crc32c.js');\n}\n\nvar crypto = require('crypto');\n\nvar _require = require('stream'),\n    PassThrough = _require.PassThrough;\n\nmodule.exports = function (cfg) {\n  cfg = cfg || {};\n  var crc32c = cfg.crc32c !== false;\n  var md5 = cfg.md5 !== false;\n  var hashes = {};\n  if (md5) hashes.md5 = crypto.createHash('md5');\n\n  var onData = function onData(chunk, enc, done) {\n    if (crc32c) hashes.crc32c = crc.calculate(chunk, hashes.crc32c || 0);\n    if (md5) hashes.md5.update(chunk);\n    done(null, chunk);\n  };\n\n  var onFlush = function onFlush(done) {\n    if (crc32c) hashes.crc32c = Buffer.from([hashes.crc32c]).toString('base64');\n    if (md5) hashes.md5 = hashes.md5.digest('base64');\n    done();\n  };\n\n  var validationStream = new PassThrough({\n    transform: onData,\n    flush: onFlush\n  });\n\n  validationStream.test = function (algo, sum) {\n    return hashes[algo] === sum;\n  };\n\n  return validationStream;\n};","map":null,"metadata":{},"sourceType":"script"}