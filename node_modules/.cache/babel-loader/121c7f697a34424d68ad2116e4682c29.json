{"ast":null,"code":"var generateIV = require('../help/generate_iv');\n\nvar base64url = require('../help/base64url');\n\nmodule.exports = function (JWA, JWK) {\n  ['A128GCMKW', 'A192GCMKW', 'A256GCMKW'].forEach(function (jwaAlg) {\n    var encAlg = jwaAlg.substr(0, 7);\n    var size = parseInt(jwaAlg.substr(1, 3), 10);\n    var encrypt = JWA.encrypt.get(encAlg);\n    var decrypt = JWA.decrypt.get(encAlg);\n\n    if (encrypt && decrypt) {\n      JWA.keyManagementEncrypt.set(jwaAlg, function (key, payload) {\n        var iv = generateIV(jwaAlg);\n\n        var _encrypt = encrypt(key, payload, {\n          iv: iv\n        }),\n            ciphertext = _encrypt.ciphertext,\n            tag = _encrypt.tag;\n\n        return {\n          wrapped: ciphertext,\n          header: {\n            tag: base64url.encodeBuffer(tag),\n            iv: base64url.encodeBuffer(iv)\n          }\n        };\n      });\n      JWA.keyManagementDecrypt.set(jwaAlg, decrypt);\n\n      JWK.oct.wrapKey[jwaAlg] = JWK.oct.unwrapKey[jwaAlg] = function (key) {\n        return (key.use === 'enc' || key.use === undefined) && key.length === size;\n      };\n    }\n  });\n};","map":null,"metadata":{},"sourceType":"script"}