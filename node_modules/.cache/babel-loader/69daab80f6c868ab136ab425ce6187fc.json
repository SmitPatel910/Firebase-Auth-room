{"ast":null,"code":"var _defineProperty = require(\"C:\\\\Users\\\\Smit\\\\Desktop\\\\RTC-React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/defineProperty\");\n\nvar _require = require('../../help/runtime_support'),\n    improvedDH = _require.improvedDH;\n\nvar _require2 = require('../../help/consts'),\n    KEYOBJECT = _require2.KEYOBJECT;\n\nvar _require3 = require('../../jwk/generate'),\n    generateSync = _require3.generateSync;\n\nvar _require4 = require('../../registry'),\n    ECDH_DERIVE_LENGTHS = _require4.ECDH_DERIVE_LENGTHS;\n\nvar derive = require('./derive');\n\nvar wrapKey = function wrapKey(wrap, derive, key, payload) {\n  var epk = generateSync(key.kty, key.crv);\n  var derivedKey = derive(epk, key, payload);\n  var result = wrap(_defineProperty({}, KEYOBJECT, derivedKey), payload);\n  result.header = result.header || {};\n  Object.assign(result.header, {\n    epk: {\n      kty: key.kty,\n      crv: key.crv,\n      x: epk.x,\n      y: epk.y\n    }\n  });\n  return result;\n};\n\nvar unwrapKey = function unwrapKey(unwrap, derive, key, payload, header) {\n  var epk = header.epk;\n  var derivedKey = derive(key, epk, header);\n  return unwrap(_defineProperty({}, KEYOBJECT, derivedKey), payload, header);\n};\n\nmodule.exports = function (JWA, JWK) {\n  ['ECDH-ES+A128KW', 'ECDH-ES+A192KW', 'ECDH-ES+A256KW'].forEach(function (jwaAlg) {\n    var kw = jwaAlg.substr(-6);\n    var kwWrap = JWA.keyManagementEncrypt.get(kw);\n    var kwUnwrap = JWA.keyManagementDecrypt.get(kw);\n    var keylen = parseInt(jwaAlg.substr(9, 3), 10);\n    ECDH_DERIVE_LENGTHS.set(jwaAlg, keylen);\n\n    if (kwWrap && kwUnwrap) {\n      JWA.keyManagementEncrypt.set(jwaAlg, wrapKey.bind(undefined, kwWrap, derive.bind(undefined, jwaAlg, keylen)));\n      JWA.keyManagementDecrypt.set(jwaAlg, unwrapKey.bind(undefined, kwUnwrap, derive.bind(undefined, jwaAlg, keylen)));\n\n      JWK.EC.deriveKey[jwaAlg] = function (key) {\n        return (key.use === 'enc' || key.use === undefined) && key.crv !== 'secp256k1';\n      };\n\n      if (improvedDH) {\n        JWK.OKP.deriveKey[jwaAlg] = function (key) {\n          return (key.use === 'enc' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('x');\n        };\n      }\n    }\n  });\n};\n\nmodule.exports.wrapKey = wrapKey;\nmodule.exports.unwrapKey = unwrapKey;","map":null,"metadata":{},"sourceType":"script"}