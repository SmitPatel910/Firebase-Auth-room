{"ast":null,"code":"\"use strict\";\n/**\n * @license\n * Copyright 2018 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar _objectSpread = require(\"C:\\\\Users\\\\Smit\\\\OneDrive\\\\Desktop\\\\RTC-React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/objectSpread\");\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\Smit\\\\OneDrive\\\\Desktop\\\\RTC-React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _possibleConstructorReturn = require(\"C:\\\\Users\\\\Smit\\\\OneDrive\\\\Desktop\\\\RTC-React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"C:\\\\Users\\\\Smit\\\\OneDrive\\\\Desktop\\\\RTC-React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"C:\\\\Users\\\\Smit\\\\OneDrive\\\\Desktop\\\\RTC-React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\n\nvar _wrapNativeSuper = require(\"C:\\\\Users\\\\Smit\\\\OneDrive\\\\Desktop\\\\RTC-React\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/wrapNativeSuper\");\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.teenyRequest = exports.RequestError = void 0;\n\nvar node_fetch_1 = require(\"node-fetch\");\n\nvar stream_1 = require(\"stream\");\n\nvar uuid = require(\"uuid\");\n\nvar agents_1 = require(\"./agents\");\n\nvar TeenyStatistics_1 = require(\"./TeenyStatistics\"); // eslint-disable-next-line @typescript-eslint/no-var-requires\n\n\nvar streamEvents = require('stream-events');\n\nvar RequestError = /*#__PURE__*/function (_Error) {\n  _inherits(RequestError, _Error);\n\n  function RequestError() {\n    _classCallCheck(this, RequestError);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(RequestError).apply(this, arguments));\n  }\n\n  return RequestError;\n}(_wrapNativeSuper(Error));\n\nexports.RequestError = RequestError;\n/**\n * Convert options from Request to Fetch format\n * @private\n * @param reqOpts Request options\n */\n\nfunction requestToFetchOptions(reqOpts) {\n  var options = _objectSpread({\n    method: reqOpts.method || 'GET'\n  }, reqOpts.timeout && {\n    timeout: reqOpts.timeout\n  }, typeof reqOpts.gzip === 'boolean' && {\n    compress: reqOpts.gzip\n  });\n\n  if (typeof reqOpts.json === 'object') {\n    // Add Content-type: application/json header\n    reqOpts.headers = reqOpts.headers || {};\n    reqOpts.headers['Content-Type'] = 'application/json'; // Set body to JSON representation of value\n\n    options.body = JSON.stringify(reqOpts.json);\n  } else {\n    if (Buffer.isBuffer(reqOpts.body)) {\n      options.body = reqOpts.body;\n    } else if (typeof reqOpts.body !== 'string') {\n      options.body = JSON.stringify(reqOpts.body);\n    } else {\n      options.body = reqOpts.body;\n    }\n  } // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  options.headers = reqOpts.headers;\n  var uri = reqOpts.uri || reqOpts.url;\n\n  if (!uri) {\n    throw new Error('Missing uri or url in reqOpts.');\n  }\n\n  if (reqOpts.useQuerystring === true || typeof reqOpts.qs === 'object') {\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    var qs = require('querystring');\n\n    var params = qs.stringify(reqOpts.qs);\n    uri = uri + '?' + params;\n  }\n\n  options.agent = agents_1.getAgent(uri, reqOpts);\n  return {\n    uri: uri,\n    options: options\n  };\n}\n/**\n * Convert a response from `fetch` to `request` format.\n * @private\n * @param opts The `request` options used to create the request.\n * @param res The Fetch response\n * @returns A `request` response object\n */\n\n\nfunction fetchToRequestResponse(opts, res) {\n  var request = {};\n  request.agent = opts.agent || false;\n  request.headers = opts.headers || {};\n  request.href = res.url; // headers need to be converted from a map to an obj\n\n  var resHeaders = {};\n  res.headers.forEach(function (value, key) {\n    return resHeaders[key] = value;\n  });\n  var response = Object.assign(res.body, {\n    statusCode: res.status,\n    statusMessage: res.statusText,\n    request: request,\n    body: res.body,\n    headers: resHeaders,\n    toJSON: function toJSON() {\n      return {\n        headers: resHeaders\n      };\n    }\n  });\n  return response;\n}\n/**\n * Create POST body from two parts as multipart/related content-type\n * @private\n * @param boundary\n * @param multipart\n */\n\n\nfunction createMultipartStream(boundary, multipart) {\n  var finale = \"--\".concat(boundary, \"--\");\n  var stream = new stream_1.PassThrough();\n\n  var _iterator = _createForOfIteratorHelper(multipart),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var part = _step.value;\n      var preamble = \"--\".concat(boundary, \"\\r\\nContent-Type: \").concat(part['Content-Type'], \"\\r\\n\\r\\n\");\n      stream.write(preamble);\n\n      if (typeof part.body === 'string') {\n        stream.write(part.body);\n        stream.write('\\r\\n');\n      } else {\n        part.body.pipe(stream, {\n          end: false\n        });\n        part.body.on('end', function () {\n          stream.write('\\r\\n');\n          stream.write(finale);\n          stream.end();\n        });\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return stream;\n}\n\nfunction teenyRequest(reqOpts, callback) {\n  var _requestToFetchOption = requestToFetchOptions(reqOpts),\n      uri = _requestToFetchOption.uri,\n      options = _requestToFetchOption.options;\n\n  var multipart = reqOpts.multipart;\n\n  if (reqOpts.multipart && multipart.length === 2) {\n    if (!callback) {\n      // TODO: add support for multipart uploads through streaming\n      throw new Error('Multipart without callback is not implemented.');\n    }\n\n    var boundary = uuid.v4();\n    options.headers['Content-Type'] = \"multipart/related; boundary=\".concat(boundary);\n    options.body = createMultipartStream(boundary, multipart); // Multipart upload\n\n    teenyRequest.stats.requestStarting();\n    node_fetch_1.default(uri, options).then(function (res) {\n      teenyRequest.stats.requestFinished();\n      var header = res.headers.get('content-type');\n      var response = fetchToRequestResponse(options, res);\n      var body = response.body;\n\n      if (header === 'application/json' || header === 'application/json; charset=utf-8') {\n        res.json().then(function (json) {\n          response.body = json;\n          callback(null, response, json);\n        }, function (err) {\n          callback(err, response, body);\n        });\n        return;\n      }\n\n      res.text().then(function (text) {\n        response.body = text;\n        callback(null, response, text);\n      }, function (err) {\n        callback(err, response, body);\n      });\n    }, function (err) {\n      teenyRequest.stats.requestFinished();\n      callback(err, null, null);\n    });\n    return;\n  }\n\n  if (callback === undefined) {\n    // Stream mode\n    var requestStream = streamEvents(new stream_1.PassThrough()); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var responseStream;\n    requestStream.once('reading', function () {\n      if (responseStream) {\n        responseStream.pipe(requestStream);\n      } else {\n        requestStream.once('response', function () {\n          responseStream.pipe(requestStream);\n        });\n      }\n    });\n    options.compress = false;\n    teenyRequest.stats.requestStarting();\n    node_fetch_1.default(uri, options).then(function (res) {\n      teenyRequest.stats.requestFinished();\n      responseStream = res.body;\n      responseStream.on('error', function (err) {\n        requestStream.emit('error', err);\n      });\n      var response = fetchToRequestResponse(options, res);\n      requestStream.emit('response', response);\n    }, function (err) {\n      teenyRequest.stats.requestFinished();\n      requestStream.emit('error', err);\n    }); // fetch doesn't supply the raw HTTP stream, instead it\n    // returns a PassThrough piped from the HTTP response\n    // stream.\n\n    return requestStream;\n  } // GET or POST with callback\n\n\n  teenyRequest.stats.requestStarting();\n  node_fetch_1.default(uri, options).then(function (res) {\n    teenyRequest.stats.requestFinished();\n    var header = res.headers.get('content-type');\n    var response = fetchToRequestResponse(options, res);\n    var body = response.body;\n\n    if (header === 'application/json' || header === 'application/json; charset=utf-8') {\n      if (response.statusCode === 204) {\n        // Probably a DELETE\n        callback(null, response, body);\n        return;\n      }\n\n      res.json().then(function (json) {\n        response.body = json;\n        callback(null, response, json);\n      }, function (err) {\n        callback(err, response, body);\n      });\n      return;\n    }\n\n    res.text().then(function (text) {\n      var response = fetchToRequestResponse(options, res);\n      response.body = text;\n      callback(null, response, text);\n    }, function (err) {\n      callback(err, response, body);\n    });\n  }, function (err) {\n    teenyRequest.stats.requestFinished();\n    callback(err, null, null);\n  });\n  return;\n}\n\nexports.teenyRequest = teenyRequest;\n\nteenyRequest.defaults = function (defaults) {\n  return function (reqOpts, callback) {\n    var opts = _objectSpread({}, defaults, reqOpts);\n\n    if (callback === undefined) {\n      return teenyRequest(opts);\n    }\n\n    teenyRequest(opts, callback);\n  };\n};\n/**\n * Single instance of an interface for keeping track of things.\n */\n\n\nteenyRequest.stats = new TeenyStatistics_1.TeenyStatistics();\n\nteenyRequest.resetStats = function () {\n  teenyRequest.stats = new TeenyStatistics_1.TeenyStatistics(teenyRequest.stats.getOptions());\n};","map":null,"metadata":{},"sourceType":"script"}