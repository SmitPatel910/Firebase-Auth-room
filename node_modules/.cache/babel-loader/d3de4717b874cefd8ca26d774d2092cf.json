{"ast":null,"code":"/*! firebase-admin v9.11.0 */\n\"use strict\";\n/*!\n * @license\n * Copyright 2021 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FirebaseInstallationsRequestHandler = void 0;\n\nvar error_1 = require(\"../utils/error\");\n\nvar api_request_1 = require(\"../utils/api-request\");\n\nvar utils = require(\"../utils/index\");\n\nvar validator = require(\"../utils/validator\");\n/** Firebase IID backend host. */\n\n\nvar FIREBASE_IID_HOST = 'console.firebase.google.com';\n/** Firebase IID backend path. */\n\nvar FIREBASE_IID_PATH = '/v1/';\n/** Firebase IID request timeout duration in milliseconds. */\n\nvar FIREBASE_IID_TIMEOUT = 10000;\n/** HTTP error codes raised by the backend server. */\n\nvar ERROR_CODES = {\n  400: 'Malformed installation ID argument.',\n  401: 'Request not authorized.',\n  403: 'Project does not match installation ID or the client does not have sufficient privileges.',\n  404: 'Failed to find the installation ID.',\n  409: 'Already deleted.',\n  429: 'Request throttled out by the backend server.',\n  500: 'Internal server error.',\n  503: 'Backend servers are over capacity. Try again later.'\n};\n/**\n * Class that provides mechanism to send requests to the FIS backend endpoints.\n */\n\nvar FirebaseInstallationsRequestHandler =\n/** @class */\nfunction () {\n  /**\n   * @param app The app used to fetch access tokens to sign API requests.\n   *\n   * @constructor\n   */\n  function FirebaseInstallationsRequestHandler(app) {\n    this.app = app;\n    this.host = FIREBASE_IID_HOST;\n    this.timeout = FIREBASE_IID_TIMEOUT;\n    this.httpClient = new api_request_1.AuthorizedHttpClient(app);\n  }\n\n  FirebaseInstallationsRequestHandler.prototype.deleteInstallation = function (fid) {\n    if (!validator.isNonEmptyString(fid)) {\n      return Promise.reject(new error_1.FirebaseInstallationsError(error_1.InstallationsClientErrorCode.INVALID_INSTALLATION_ID, 'Installation ID must be a non-empty string.'));\n    }\n\n    return this.invokeRequestHandler(new api_request_1.ApiSettings(fid, 'DELETE'));\n  };\n  /**\n   * Invokes the request handler based on the API settings object passed.\n   *\n   * @param apiSettings The API endpoint settings to apply to request and response.\n   * @return A promise that resolves when the request is complete.\n   */\n\n\n  FirebaseInstallationsRequestHandler.prototype.invokeRequestHandler = function (apiSettings) {\n    var _this = this;\n\n    return this.getPathPrefix().then(function (path) {\n      var req = {\n        url: \"https://\" + _this.host + path + apiSettings.getEndpoint(),\n        method: apiSettings.getHttpMethod(),\n        timeout: _this.timeout\n      };\n      return _this.httpClient.send(req);\n    }).then(function () {// return nothing on success\n    }).catch(function (err) {\n      if (err instanceof api_request_1.HttpError) {\n        var response = err.response;\n        var errorMessage = response.isJson() && 'error' in response.data ? response.data.error : response.text;\n        var template = ERROR_CODES[response.status];\n        var message = template ? \"Installation ID \\\"\" + apiSettings.getEndpoint() + \"\\\": \" + template : errorMessage;\n        throw new error_1.FirebaseInstallationsError(error_1.InstallationsClientErrorCode.API_ERROR, message);\n      } // In case of timeouts and other network errors, the HttpClient returns a\n      // FirebaseError wrapped in the response. Simply throw it here.\n\n\n      throw err;\n    });\n  };\n\n  FirebaseInstallationsRequestHandler.prototype.getPathPrefix = function () {\n    var _this = this;\n\n    if (this.path) {\n      return Promise.resolve(this.path);\n    }\n\n    return utils.findProjectId(this.app).then(function (projectId) {\n      if (!validator.isNonEmptyString(projectId)) {\n        // Assert for an explicit projct ID (either via AppOptions or the cert itself).\n        throw new error_1.FirebaseInstallationsError(error_1.InstallationsClientErrorCode.INVALID_PROJECT_ID, 'Failed to determine project ID for Installations. Initialize the ' + 'SDK with service account credentials or set project ID as an app option. ' + 'Alternatively set the GOOGLE_CLOUD_PROJECT environment variable.');\n      }\n\n      _this.path = FIREBASE_IID_PATH + (\"project/\" + projectId + \"/instanceId/\");\n      return _this.path;\n    });\n  };\n\n  return FirebaseInstallationsRequestHandler;\n}();\n\nexports.FirebaseInstallationsRequestHandler = FirebaseInstallationsRequestHandler;","map":null,"metadata":{},"sourceType":"script"}